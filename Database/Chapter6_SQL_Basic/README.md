# 6강 SQL 문의 기본

## SELECT 문의 기본

- 어디서(FROM 테이블) 무엇을 가지고 온다(SELECT 열명)

  ```sql
  SELECT 열명 FROM 테이블명;
  ```

- 열명에 별표(\*)를 사용하면 'FROM 테이블명'에서 지정한 테이블의 전체 열을 지정할 수 있다.

- 콤마(,)로 구분해 복수로 지정할 수도 있다.

### WHERE 조건이 필요한 이유

- 필요한 데이터를 효율성있게 가져 오기 위함

  ```sql
  SELECT 열명 FROM 테이블명 WHERE 조건;
  ```

- 조건에 일치하는 행만 SELECT 한다.
  - 비교 연산자 'AND'와 'OR'이 자주 사용된다.

<br>

### SQL의 기초적인 기술 규칙

- SQL 문의 마지막에 딜리미터(Delimiter)(문장의 단락을 의미)를 붙인다.

  - 대부분은 세미콜론 (;)

- 키워드 (SELECT, WHERE)의 대문자와 소문자는 구별하지 않는다.

- 정수는 기존 그대로 쓴다. 문자열이나 날짜 시각은 작은따옴표('')로 감싼다.

단어는 반각 스페이스나 개행으로 구별한다. 전각 스페이스는 사용하지 않는다.

<br>

### DISTINCT에 의한 중복 배제

- 선택한 행에서 중복된 값이 있고 이를 없애고 싶은 경우에는 'DISTINCT' 키워드를 지정한다.

  ```sql
  SELECT distinct district FROM city WHERE countrycode = 'kor';
  ```

<br>

# 7강 SELECT문 응용

## 검색결과 정렬

- 'ORDER BY'란 명령으로 행의 순서를 지정한다.

  ```sql
  SELECT ~ ORDER BY 열1[, 열2, ...] [ASC];
  ```

- 내림차순 정렬도 가능하다.
  ```sql
  SELECT ~ ORDER BY 열1[, 열2, ...] desc;
  ```

<br>

## 정렬시 주의할 점

- 행의 정렬키를 한 가지 의미(Unique)로 정해야 한다.
  - 컬럼의 값이 복수개 존재한다면 순서가 일정하지 않을 수 있다.

<br>

## 테이블 요약하는 함수

- 함수

  - 데이터에 대해 어떠한 조작이나 계산을 수행할때 사용하는 도구

  - 복수 행에 대해 집계를 수행하는 함수

  - 단일 행의 값에 대해 조작이나 계산을 수행하는 함수

- 집계용 함수(집약함수)

  - COUNT : 테이블의 행수를 알려주는 함수

  - SUM : 테이블의 수치 데이터를 합계하는 함수

  - AVG : 테이블의 수치 데이터 평균을 구하는 함수

  - MAX : 테이블의 임의열 데이터 중 최대값을 구하는 함수

  - MIN : 테이블의 임의열 데이터 중 최소값을 구하는 함수

- 집약함수는 기본적으로 NULL을 제외하고 집계하는데, COUNT (\*)로 표기하여 NULL을 포함한 전체 행을 집계

<br>
d
## 데이터를 그룹으로 나누는 GROUP BY

- 대상이 되는 데이터를 몇 개의 그룹으로 나눠서 집약하는 것도 가능

- '행정구역(distric)'마다, '국가(country)'마다 집약하는 식

  ```sql
  SELECT - FROM 테이블명 GROUP BY 열명1 [, 열명2, ...];
  ```

<br>

## 나눈 그룹에 조건 추가

<br>

## 집약한 결과에 조건 지정

- 그룹마다 집약한 값을 조건으로 선택하고 싶다면 HAVING 뒤에 조건을 다음과 같이 지정

  ```sql
  SELECT - FROM ~ GROUP BY 그룹의 값에 대한 조건;
  ```

<br>

# 8강 데이터를 갱신, 삽입, 제거해 보자

## 데이터의 갱신과 삽입

### 데이터 변경하는 UPDATE문

```sql
UPDATE 테이블명 SET 열명 = 값 WHERE 조건;
```

- WHERE 구문에 부합하는 행 전부에 대해 갱신이 수행된다.
- 복수열을 동시에 갱신하기 위해서는 AND로 지정하거나 유니크한 열을 조건으로 지정한다.
- ```sql
  update city set name = 'siheung', population = 429390 where countrycode = 'KOR' and district = 'Kyonggi' and name= 'Shihung';​
  ```

<br>

### 데이터 입력하는 INSERT문

```sql
INSERT INTO 테이블명(열1,[, 열2, ...]) VALUES (값1[, 값2, ...]);
```

- INSERT는 행 단위로 수행되므로 테이블 정의를 정확하게 알아야 한다.

- 테이블명 뒤의 열 리스트와 VALUES 뒤의 값 리스트는 수와 데이터형이 일치되어야 한다.

- 테이블에 정의된 모든 열에 대해 VALUES에서 값을 설정하면 테이블명의 열 리스트를 생략할 수 있다.

- INSERT문에서 값 대신에 DEFAULT 키워드를 지정하면 테이블 정의에 지정된 기본값이 지정된다.

<br>

```sql
INSERT INTO 테이블1 SELECT * FROM 테이블2
```

- 위의 구문을 사용하면 VALUES 대신 입력한 값(레코드)로 SELECT 문의 결과를 사용하는 방법이다.

- 기존의 데이터를 통해 1행으로 복수의 레코드 입력이 가능하다.

<br>

```sql
CREATE TABLE 테이블명1 LIKE 테이블명2
```

- MySQL에서는 위의 구문을 통해 테이블명2와 같은 구조의 테이블을 작성할 수 있다.

- 또한 MySQL에서는 INSERT문 하나로 신규 복수행을 입력할 수 있는 '복수 행의 입력' 기능이 있다.

- 콤마 , 로 이어서 복수의 레코드를 입력 가능하다.

<br>

### 데이터를 제거하는 DELETE문

```sql
DELETE FROM 테이블명 WHERE 조건;
```

- WHERE로 지정한 조건에 맞는 항목을 제거한다.
- 1행을 대상으로 제거하려면 WHERE 구문의 대상을 유니크하게 특정해야한다.

<br>

# 9강 뷰 작성, 복수 테이블에서 선택

## 뷰 작성과 서브쿼리 및 결합

- 뷰는 SQL 시점에서 테이블과 동일하지만 테이블과 같은 데이터는 가지고 있지 않으며, 테이블에 대한 SELECT를 가지고 있다.

- 테이블 대신 뷰를 사용하는 이점

  - 복잡한 SELECT문을 일일이 매번 기술할 필요가 없다.

  - 필요한 열과 행만 사용자에게 보여줄 수 있고, 갱신 시 뷰 정의에 따른 갱신으로 한정할 수 있다.

  - 데이터 저장 없이 실현할 수 있고, 뷰를 제거해도 참조하는 테이블은 영향을 받지 않는다.

<br>

## 뷰 작성 CREATE문

```sql
CREATE VIEW 뷰 명(열명1[, 열명2,...]) AS SELECT문;
```

- SELECT문에서 열 전체를 지정했을 경우 뷰명 뒤의 괄호와 열 리스트는 생략할 수 있다.

<br>

## 결합 (JOIN)

- 하나의 테이블에 있는 열만으로는 데이터가 충족되지 않는 경우 열을 가지고 오는 조작.

- 결합 조건을 지정해 2개 테이블의 행을 결합한다.

### Inner JOIN (내부 결합)

- 테이블에서 필요한 열을 가지고 올 때 행을 결합하기 위한 조건을 'ON'으로 지정한다.

- 내부결합에서는 이 ON으로 지정한 결합 조건에 일치하는 행만을 2개의 테이블로부터 가져온다.

- 결합조건으로 country code를 사용한다.

- 열이 어디서 왔는지 알고 싶을 경우 '테이블명.열명' 과 같이 지정한다.

```sql
SELECT 선택하고 싶은 열 리스트 FROM 첫 번째 테이블명 INNER JOIN 두 번째 테이블명 ON 결합조건;
```

<br>

### Outer JOIN (외부 결합)

- 한쪽 테이블을 기준으로 전체 행을 표시하고 다른 테이블은 값이 있으면 표시
- 두개의 테이블 중 왼쪽 테이블의 전체 행이 표시되고, 다른 테이블의 행 데이터는 결합 조건과 일치할 때 그 값이 되고, 일치하는 것이 없으면 'NULL' 이 된다.
- LEFT OUTER JOIN 또는 RIGHT OUTER JOIN 을 사용한다. (보통 LEFT가 기준)

```sql
SELECT 선택하고 싶은 열의 리스트 FROM 첫 번째 테이블명 LEFT OUTER JOIN 두 번째 테이블명 ON 결합조건;
```
