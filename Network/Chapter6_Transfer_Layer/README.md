# 전송 계층: 신뢰할 수 있는 데이터 전송하기

## 전송 계층의 두 가지 역할

목적지에 신뢰할 수 있는 데이터를 전달

1. 오류를 점검하는 기능

2. 전송된 데이터의 목적지가 어떤 애플맄이션인지 식별하는 기능

### 연결형 통신과 비연결형 통신

---

- *신뢰성/정확성*과 *효율성*으로 구분할 수 있다.

### 연결형 통신 (TCP)

- 정확한 데이터를 전달하는 통신

### 비연결형 통신 (UDP)

- 효율적으로 데이터를 전달하는 통신

- 데이터 전송에 확인 절차가 없다.

- 주로 동영상을 볼 때 사용한다.

<br>

## TCP의 구조

### TCP

- TCP 헤더

  - 목저지까지 데이터를 제대로 전송하기 위해 필요한 정보를 가지고 있다.

- 세그먼트
  - TCP 헤더가 붙은 데이터
- 연결(connection)

  - 가상의 독점 통신로 확보

  - TCP 헤더의 구성요소 중 코드 비트(6비트) 사용
    - SYN -> 비트 활성화(1)시 연결 요청
    - ACK -> 비트 활성화(1)시 확인 응답

<br>

### 3-way 핸드셰이크

- 연결은 SYN, ACK를 사용하여 확립한다.

- 신뢰할 수 있는 연결을 위해 데이터 전송하기 전에 패킷을 3번 교환한다.

1. 연결 확립 요청 [SYN]

   - 컴퓨터 1 -> 컴퓨터 2로 연결 확립 허가 요청(SYN)을 보낸다.

   | URG | ACK | PSH | RST | SYN | FIN |
   | :-: | :-: | :-: | :-: | :-: | :-: |
   |  0  |  0  |  0  |  0  |  1  |  0  |

2. 연결 확립 응답 + 연결 확립 요청 [ACK] + [SYN]

   - 컴퓨터 2는 허가 응답 회신(ACK)와 함께 컴퓨터 1에게 데이터 전송 허가 요청(SYN)을 보낸다.

   | URG | ACK | PSH | RST | SYN | FIN |
   | :-: | :-: | :-: | :-: | :-: | :-: |
   |  0  |  1  |  0  |  0  |  1  |  0  |

3. 연결 확립 응답 [ACK]

   - 컴퓨터 2의 요청에 대한 허가 응답(ACK)을 컴퓨터 1에서 보낸다.

   | URG | ACK | PSH | RST | SYN | FIN |
   | :-: | :-: | :-: | :-: | :-: | :-: |
   |  0  |  1  |  0  |  0  |  0  |  0  |

- 연결을 끊을 때는 FIN 과 ACK를 사용한다.

1. 연결 종료 요청 [FIN]
   - 컴퓨터 1에서 컴퓨터 2로 연결 종류 요청(FIN)을 보낸다.
2. 연결 종료 응답 [ACK]
   - 컴퓨터 2에서 컴퓨터 1로 연결 종료 응답을 반환한다.
3. 연결 종료 요청 [FIN]
   - 컴퓨터 2에서도 컴퓨터 1로 연결 종룔 요청(FIN)을 보낸다.
4. 연결 종료 응답 [ACK]
   - 컴퓨터 1에서 컴퓨터 2로 연결 종료 응답(ACK)을 반환한다.

<br>

## 일련번호와 확인 응답 번호의 구조

### 일련번호와 확인 응답 번호

<br>

**실제 데이터를 보내거나 상대방이 받을 때 쓰이는 비트**

- 일련번호(sequence number) (32비트)

  - 송신 측에서 수신 측에 데이터의 순서를 알려 주는 역할

- 확인 응답 번호(acknowledgement number) (32비트)

  - 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할

    - 다음 번호의 데이터를 요청하는 데도 사용된다.

    - 확인 응답 == 10번 데이터를 수신하면 11번 데이터를 송신 측에 요청한다.

<br>

## 윈도우 크기

- 윈도우 크기(16비트)

  - 버퍼의 한계 크기

  - 오버플로 발생하지 않도록 한계 크기를 알 필요가 있다.

  - 얼마나 많은 용량의 데이터를 저장해 둘 수 있는지를 나타낸다.

  - 초기값은 3-way handshake 시 판단한다.

1. 연결 확립 요청

   - 컴퓨터 1의 윈도우 크기를 컴퓨터 2가 인식한다.

   | 일련번호 | 확인 응답 번호 | 윈도우 크기 |
   | :------: | :------------: | :---------: |
   |          |                |    3000     |

2. 연결 확립 응답 + 연결 확립 요청

   - 컴퓨터 2의 윈도우 크기를 컴퓨터 1이 인식한다.

   | 일련번호 | 확인 응답 번호 | 윈도우 크기 |
   | :------: | :------------: | :---------: |
   |          |                |    2000     |

3. 연결 확립 응답

<br>

- 버퍼(buffer)

  - 세그먼트를 일시적으로 보관하는 장소

  - 3-way handshake와 같이 한 번 보낼 때마다 한 번 응답을 반환하는 방식은 비효율적이다.

  - 매번 확인 응답을 기다리는 대신 세그먼트를 연속해서 보내고 확인 응답을 반환할 수 있다.

- 오버플로(overflow)
  - 수신 측에서 대량으로 전송된 데이터를 보관하지 못하고 넘쳐 버리는 현상

<br>

## 포트 번호의 구조

- 전송된 데이터의 목적지가 어떤 애플리케이션인지 구분하기 위함

### 포트 번호 (TCP 헤더)

1. 출발지 포트 번호 (16비트)

2. 목적지 포트 번호 (16비트)

- 포트 번호 범위 (0 ~ 65535)

  - 잘 알려진 포트(well-known ports)

    - 0 ~ 1023번

    - 주요 프로토콜이 사용하도록 예약되어 있다.

    - 주로 서버 측 애플리케이션에 사용한다.

  - 랜덤 포트

    - 1025번 이상

    - 클라이언트 측의 송신 포트로 사용한다.

  - 1024번
    - 예약 되어 있지만 사용되지는 않는 포트

<br>

## UDP의 구조

### UDP

- 비연결형 통신

- 데이터를 효율적으로 빠르게 보내는 것이 중요

<br>

### UDP 헤더

- UDP 데이터그램

  - UDP 헤더가 붙은 데이터
