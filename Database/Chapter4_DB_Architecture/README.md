# 데이터베이스의 아키텍처

## 다중화(고가용성)

## 아키텍처

### 아키텍처 설계 필요성

- 아키텍처
  - 시스템을 만들기 위한 물리 레벨의 조합
  - 어떠한 저장소나 네트워크 기기와 조합해서 시스템 전체를 만들 것인가
  - 하드웨어와 미들웨어의 구성

### 시스템의 목적과 기능

- 아키텍처를 보면 그 시스템이 어떤 용도로 사용되고 무엇을 목적으로 하고 있는지를 어느 정도 추측할 수 있다.

### 아키텍처 설계의 중요성

- 시스템에 요구되는 조건을 충족하기 위해 어떤 아키텍처가 적당할지 고민하는 것은 비용과 직결되는 행위이다.

## 데이터베이스의 아키텍처 - 역사와 개요

### 아키텍처의 역사

1. Stand-alone (~1980년대)

   - 네트워크에 접속하지 않고 독립되어 동작하는 구성

   - 단점

     - 물리적으로 떨어진 장소에서 액세스 불가능

     - 복수 사용자가 동시에 작업할 수 없다.

     - 가용성이 낮다.

     - 확장성이 부족하다.

   - 장점

     - 구축이 간단하다.

     - 보안이 매우 높다.

2. 클라이언트/서버 (1990년대 ~ 2000년대)

   - 데이터베이스 서버 1대에 복수 사용자의 단말이 접속하는 구성

   - 물리적으로 떨어진 장소에서 접속할 수 있다.
   - 복수 사용자가 동시 작업할 수 있다.

   - 단점

     - 인터넷에서 직접 데이터베이스에 접속하는 것에 대한 보안 위험

     - 불특정 다수의 사용자가 사용하는 클라이언트에서의 애플리케이션 관리비용이 많이 드는 점

3. Web 3계층 (2000년 ~ 현재)

   - 비즈니스 로직을 실행하는 애플리케이션 서버에서 관리해 비용을 절감하도록함.

   - 계층

     - 웹 서버 계층

       - 클라이언트로부터 HTTP 요청을 직접 받아 뒷단의 애플리케이션 계층에 넘기고 그 결과를 반환
       - 아파치, IIS 등

     - 애플리케이션 계층
     - 비즈니스 로직을 구현한 애플리케이션 동작 층
     - 웹 서버로부터 연계된 요청을 처리하고, 필요시 데이터베이스 계층에 접속해 데이터 추출, 이를 가공한 결과를 웹 서버로 반환
     - 톰캣, 웹로직, 웹스피어 등

     - 데이터베이스 계층

   - 직접적인 접속 요청 받는 역할을 웹서버에 한정하여 애플리케이션 계층, 데이터베이스 계층의 보안을 높인다.
   - 비즈니스 로직 구현을 한 계층에 집중하므로써 관리 비용을 낮춘다.

## 데이터베이스의 아키텍처 - 가용성과 확장성의 확보

### 가용성 향상 전략 2가지

1. 심장전략(고품질 - 소수전략)

   - 시스템을 구성하는 각 컴포넌트의 신뢰성을 높여 장애 발생률을 낮게 억제해서 가용성을 높인다.(소수정예 노선)

2. 신장전략(저품질 - 다수전략)
   - 사물은 언젠가 망가진다란 체념을 전제로 여분 준비(물량작전)

### 클러스터란

- 동일한 기능의 컴포넌트를 병렬화하는 것 (신장전략과 비슷)

- 동일한 기능의 컴포넌트를 복수 개 준비해 한 개의 기능을 실현한다.

- 여유도 (다중화)

  - 클러스터 구성으로 시스템의 가동률을 높이는 것

  - 내구성이 더 높고 견고하다

- 가동률 100%는 원리적으로 불가능하다.
- 서버 대수가 증가할수록 1대를 추가함에 따라 얻을 수 있는 가동률의 향상 폭이 작아진다.

### 단일 장애점

- 다중화되어 있지 않아서 시스템 전체 서비스의 계속성에 영향을 주는 컴포넌트

- 단일 장애점의 신뢰성이 시스템 전체의 가용성을 결정한다.

## DB 서버의 다중화 - 클러스터링

### DB와 다른 서버의 차이

- 데이터베이스는 대량의 데이터를 영구적으로 보존해야 하고 그에 따른 성능이 요구되어 고려할 사항이 많다.
  - 영속 계층으로서의 속성
  - 데이터 정합성

### 가장 기본적인 다중화

- Active-Active
  - 클러스터를 구성하는 컴포넌트를 동시에 가동한다.
  - Oracle -> RAC(Real Application Clusters)
  - DB2 -> pureScale
- Active-Standby
  - 클러스터를 구성하는 컴포넌트 중 실제 가동하는 것은 Active, 남은 것은 대기 (Standby)하고 있는다.

### Active-Active 구성의 장점

1. 시스템 다운 시간이 짧다.
   - 웹서버나 애플리케이션 서버의 클러스터링으로 얻을 수 있는 장점과 같다.
2. 성능이 좋다.
   - 서버 대수가 증가하면 동시에 가동하는 CPU나 메모리도 증가하기 때문에 성능이 향상될 수 있다.

- Active-Standby
  - Active DB 서버에서 장애가 일어날 때만 사용 -> 전환될 때까지 시차가 생기고 그 사이 시스템은 다운 상태가 된다.

### Active-Standby 구성의 종류

- Cold-Standy
  - 평소에는 Standy DB가 작동하지 않다가 Active DB가 다운된 시점에 작동하는 구성이다.
- Hot-Standy
  - 평소에도 Standy DB가 작동하는 구성이다.
  - Cold-Standy에 비해 라이선스료가 높게 설정되어 있다.

## DB 서버와 데이터의 다중화 - 리플리케이션

### 리플리케이션이란

- DB서버와 저장소 세트를 복수로 준비하는 것

### 리플리케이션에서 주의할 점

- Active 측 저장소의 데이터는 하상 사용자로부터 갱신된다.
  - Standy 측 데이터에도 갱신을 반영하여 최신화하지 않으면 Active 측과 데이터 정합성을 유지할 수 없다.
  - 갱신 주기와 성능 사이에 트레이드오프 관계가 생긴다.

## 성능을 추구하기 위한 다중화 - Shared Nothing

### Shared Disk와 Shared Nothing

- Shared Disk

  - 복수의 서버가 1대의 디스크를 사용하는 구성
  - Shared Disk 타입의 Active-Active 구성은 서버를 늘려도 무한으로 처리율이 향상되지 않는다.  
    -> 저장소가 공유 자원이라 늘리기 어렵고 DB 서버 대수가 증가할 수록 정보공유를 위한 오버헤드가 크기 때문

- Shared Nothing(Sharding : 샤딩)
  - Shared Disk의 처리율 향상 문제 해결을 위한 아키텍쳐
  - 서버와 저장소의 세트를 늘리면 병렬처리 때문에 선형적으로 성능이 향상된다.
  - 비용 대비 성능이 좋다.
  - 각각의 DB 서버가 동일한 1개의 데이터에 액세스할 수 없다.
