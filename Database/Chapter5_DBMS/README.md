# 5장 DBMS를 조작할 때 필요한 기본 지식

## MySQL과 커넥션 만들기

### 로그인의 의미

- MySQL이라는 DMBS에 사용자가 로그인해서 조작할 수 있게 된 상태

- `mysql>` : 문자열은 `프롬프트`

### 커넥션

- 로그인해서 프롬프트가 표시되었다 = 사용자와 MySQL이 접속되었다. = 커넥션

## 데이터베이스에 전화 걸기

### 커넥션의 이미지는 전화

1. 상대방의 전화번호를 입력한다.

2. 전화를 건다.

3. 상대방이 전화를 받는다.

### 커넥션의 상태를 조사하는 명령

- `show status`

`mysql> show status like 'Threads_coonected;`

### 전화를 끊다 - 로그오프

`mysql> quit`

## SQL과 관리 명령의 차이

### 관리 명령이란

### 관리 명령에서 기억해야 할 점

- DBMS는 SQL 문 이외에도 '관리 명령'이 있다.

- 관리 명령의 종류나 문법은 DBMS에 따라 다르다.

## 관계형 데이터베이스의 계층

### 데이터베이스는 계층으로 나뉘어 있다.

### 폴더에 해당하는 스키마

### 최상위에 있는 인스턴스

- DBMS가 동작할 때의 단위이다.

- `인스턴스 > 복수 개의 데이터베이스들 > 복수 개의 스키마들`

### MySQL과 Oracle의 계층 구조

- MySQL
  - 데이터베이스와 스키마는 동일한 것으로 간주 -> 계층 차이를 두지 않음
  - 3계층
  - 인스턴스 - 스키마 - 테이블
- Oracle
  - `인스턴스 아래에 데이터베이스를 한 개만 만들 수 있다.`
  - 4계층
  - 인스턴스 1 - 데이터베이스 1 - 스키마 - 테이블

## 13강 문자열 연산

`CONCAT SUBSTRING TRIM CHARACTER_LENGTH`

### 문자열 결합

- 문자열 결합에 + 연산자를 사용한다.

- Oracle이나 DB2, PostgreSQL에서는 || 연산자를 사용해서 무낮열을 결합한다.

- MySQl에서는 CONCAT 함수로 문자열 결합한다.

- 문자열 결합은 2개의 열 데이터를 모아서 1개의 열로 처리하고 싶은 경우 사용

### SUBSTRING 함수

- 문자열의 일부분으 계산해서 반환해주는 함수

- SUBSTR인 경우도 있다.

- 날짜와 연속된 번호를 사용해 유일한 ID를 지정하는 경우가 많다.

  - 사용자가 업로드한 데이터를 특정지을 수 있도록 하기 위함.

- 앞 4자리(년) 추출
  `SUBSTRING('20140125001', 1, 4)` -> `'2014'`

- 5째 자리부터 2자리(월) 추출
  `SUBSTRING('20140125001', 5, 2)` -> `'01'`

### TRIM 함수

- 문자열의 앞뒤로 여분의 스페이스가 있을 경우 이를 제거해주는 함수

- 문자열 도중에 존재하는 스페이스는 제거되지 않는다.

- 고정길이 문자열형에 대해 많이 사용한다.

- 인수를 지정하는 것으로 스페이스 이외의 문자를 제거할 수도 있다.

`TRIM('ABC ')` -> `'ABC'`

### CHARACTER_LENGTH 함수

- 문자열의 길이를 계산해 돌려주는 함수

- VARCHAR 형의 문자열은 가변 길이이므로 길이가 서로 다르다.

- 문자열의 길이를 계산할 수 있다.

- 문자열의 길이는 문자 단위로 계산되어 수치로 반환된다.

- 함수명은 CHAR_LENGTH로 줄여서 사용할 수 있다.

- OCTET_LENGTH 함수는 문자열의 길이를 바이트 단위로 계산해 반환한다.

- 문자열을 수치화(인코드) 하는 방식에 따라 필요한 저장공간의 크기가 달라진다.

- VARCHAR 형의 최대 길이 역시 바이트 단위로 지정한다.

### 문자세트(character set)

- 한 문자가 몇 바이트인지는 쓰이는 문자세트에 따라 다르다.

- 알파벳 -> 반각 문자
  - 전각 문자 폭의 절반 -> 저장 용량 적다.
- 한글 -> 전각 문자

  - `EUC-KR`, `UTF-8` 인코딩 방식 사용
  - 인코드 방식은 데이터베이스나 테이블 정의시 변경 가능

- CHAR_LENGTH 함수 사용시 문자수로 계산되어 문제 없다.

- OCTET_LENGTH 함수 사용시 바이트 단위 길이 계산 -> 문자세트에 주의한다.

## 14강 날짜 연산

`CURRENT_TIMESTAMP CURRENT_DATE INTERVAL`

### SQL에서의 날짜

- 시스템 날짜

  - `CURRENT_TIMESTAMP'  
    -> 일반적인 함수와 달리 인수를 지정할 필요없다. 시스템 상 시간을 출력한다.

- 날짜 서식

  - 국가별로 다르다.

  - Oracle : TO_DATE 함수로 문자열 데이터 -> 날짜형 데이터
  - `TO_DATE('2014/01/25', 'YYYY/MM/DD')`

### 날짜의 뎃셈과 뺄셈

- 날짜시간형 데이터는 기간형 수치데이터와 덧셈 뺄셈이 가능하다.

- 날짜를 연산해 시스템의 날짜의 1일 후를 검색

`SELECT CURRENT_DATE + INTERVAL 1 DAY;`

| CURRENT_DATE + INTERVAL 1 DAY |
| :---------------------------: |
|          2014-01-26           |

- 날짜형 간의 뺄셈도 가능하다.

## 15강 CASE 문으로 데이터 변환하기

### CASE 문

```sql
CASE WHEN 조건식1 THEN 식1
    [WHEN 조건식2 THEN 식2 ...]
    [ELSE 식3 ]
END
```

- WHEN 절에는 참과 거짓을 반환하는 조건식을 기술한다.

- 해당 조건 만족하여 참이 되는 경우 THEN 절 기술한 식 처리

- COALESCE

```sql
SELECT a, COALESCE(a, 0) FROM sample 37;
```

- 주어진 인수 가운데 NULL이 아닌 값에 대해서는 가장 먼저 지정된 인수의 값을 반환한다.

- a가 NULL이 아니면 a 값 그대로 출력하고, 그렇지 않으면 0을 출력

### 또 하나의 CASE 문

```sql
WHEN a=1 THEN '남자'
WHEN a=2 THEN '여자'
```

- 검색 CASE
  - `CASE WHEN 조건식 THEN 식` 형태
- 단순 CASE
  - `CASE 식 WHEN 조건식 THEN 식` 형태

### CASE 사용시 주의사항

- ELSE 생략

  - ELSE 생략시 ELSE NULL 이 되는 것에 주의할 것.

- WHEN에 NULL 지정하기

  - 비교 연산자 = 으로는 NULL 값과 같은지 아닌지 비교 불가하다.
  - 따라서 a 값이 NULL 이라도 a=NULL은 참이 아니다. -> '데이터 없음' 출력
  - NULL 값 판단을 위해 `IS NULL`을 사용

- DECODE NVL
    - 오라클에 내장